{% extends "base.html" %}

{% block title %}Chequeo de Resultados Playoff{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-4">
                <i class="fas fa-clipboard-check"></i> Chequeo de Resultados Playoff
            </h1>
            <p class="text-muted">VisualizaciÃ³n de partidos de playoff con resultados cargados</p>
            <hr>
        </div>
    </div>

    {% if partidos_por_fase %}
        {% for clave_fase, datos_fase in partidos_por_fase.items() %}
            <div class="card mb-4 shadow">
                <div class="card-header bg-info text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-trophy"></i> {{ datos_fase.torneo }} - {{ datos_fase.fase_nombre }}
                        {% if datos_fase.ida_vuelta %}
                            <span class="badge badge-warning ml-2">Ida y Vuelta</span>
                        {% else %}
                            <span class="badge badge-secondary ml-2">Fase Ãšnica</span>
                        {% endif %}
                    </h4>
                </div>
                <div class="card-body p-0">
                    <!-- Tabla de Partidos -->
                    <table class="table table-striped table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Jornada</th>
                                <th>CategorÃ­a</th>
                                <th>Fecha</th>
                                <th>Hora</th>
                                <th>Equipo Local</th>
                                <th class="text-center">Resultado</th>
                                <th>Equipo Visitante</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for partido in datos_fase.partidos %}
                                <tr class="align-middle">
                                    <td>
                                        {% if datos_fase.ida_vuelta %}
                                            {% if partido.jornada == 1 %}
                                                <span class="badge badge-info">Ida</span>
                                            {% else %}
                                                <span class="badge badge-warning">Vuelta</span>
                                            {% endif %}
                                        {% else %}
                                            <span class="badge badge-secondary">{{ partido.jornada }}</span>
                                        {% endif %}
                                    </td>
                                    <td><span class="badge badge-primary">{{ partido.categoria|upper }}</span></td>
                                    <td>
                                        {% if partido.fecha %}
                                            {{ partido.fecha.strftime('%d/%m/%Y') }}
                                        {% else %}
                                            <span class="text-muted">Sin fecha</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if partido.hora %}
                                            {{ partido.hora.strftime('%H:%M') }}
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <strong>{{ partido.equipo_local.nombre }}</strong>
                                    </td>
                                    <td class="text-center">
                                        <button class="btn btn-sm btn-outline-dark" data-toggle="collapse" data-target="#partido-{{ partido.id }}" aria-expanded="false">
                                            <strong class="text-danger">{{ partido.goles_local }} - {{ partido.goles_visitante }}</strong>
                                        </button>
                                    </td>
                                    <td>
                                        <strong>{{ partido.equipo_visitante.nombre }}</strong>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-info" data-toggle="collapse" data-target="#detalles-{{ partido.id }}">
                                            <i class="fas fa-eye"></i> Detalles
                                        </button>
                                    </td>
                                </tr>
                                
                                <!-- Detalles del partido (Colapsar) -->
                                <tr class="collapse" id="detalles-{{ partido.id }}">
                                    <td colspan="8">
                                        <div class="p-3 bg-light">
                                            <div class="row">
                                                <!-- Equipo Local -->
                                                <div class="col-md-6">
                                                    <h6 class="font-weight-bold text-primary mb-3">
                                                        <i class="fas fa-home"></i> {{ partido.equipo_local.nombre }}
                                                    </h6>
                                                    {% set local_goleadores = [] %}
                                                    {% set local_tarjetas = [] %}
                                                    {% for carnet, stats in partido.estadisticas.items() %}
                                                        {% if stats.goles > 0 %}
                                                            {% set _ = local_goleadores.append(stats) %}
                                                        {% endif %}
                                                        {% if stats.amarillas > 0 or stats.rojas > 0 %}
                                                            {% set _ = local_tarjetas.append(stats) %}
                                                        {% endif %}
                                                    {% endfor %}
                                                    
                                                    {% if local_goleadores %}
                                                        <div class="mb-2">
                                                            <p class="mb-1"><strong>âš½ Goleadores:</strong></p>
                                                            <ul class="list-unstyled ml-3">
                                                                {% for jugador in local_goleadores %}
                                                                    <li>
                                                                        <span class="text-success"><i class="fas fa-futbol"></i></span> 
                                                                        <strong>{{ jugador.nombre }}</strong> - <span class="badge badge-success">{{ jugador.goles }}</span>
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                        </div>
                                                    {% else %}
                                                        <p class="text-muted mb-2"><em>Sin goles registrados</em></p>
                                                    {% endif %}
                                                    
                                                    {% if local_tarjetas %}
                                                        <div class="mb-2">
                                                            <p class="mb-1"><strong>ðŸŸ¨ Tarjetas:</strong></p>
                                                            <ul class="list-unstyled ml-3">
                                                                {% for jugador in local_tarjetas %}
                                                                    <li>
                                                                        {{ jugador.nombre }}
                                                                        {% if jugador.amarillas > 0 %}
                                                                            <span class="badge badge-warning">{{ jugador.amarillas }} ðŸŸ¨</span>
                                                                        {% endif %}
                                                                        {% if jugador.rojas > 0 %}
                                                                            <span class="badge badge-danger">{{ jugador.rojas }} ðŸŸ¥</span>
                                                                        {% endif %}
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                        </div>
                                                    {% else %}
                                                        <p class="text-muted"><em>Sin tarjetas registradas</em></p>
                                                    {% endif %}
                                                </div>
                                                
                                                <!-- Equipo Visitante -->
                                                <div class="col-md-6">
                                                    <h6 class="font-weight-bold text-danger mb-3">
                                                        <i class="fas fa-road"></i> {{ partido.equipo_visitante.nombre }}
                                                    </h6>
                                                    {% set visitante_goleadores = [] %}
                                                    {% set visitante_tarjetas = [] %}
                                                    {% for carnet, stats in partido.estadisticas.items() %}
                                                        {% if stats.goles > 0 %}
                                                            {% set _ = visitante_goleadores.append(stats) %}
                                                        {% endif %}
                                                        {% if stats.amarillas > 0 or stats.rojas > 0 %}
                                                            {% set _ = visitante_tarjetas.append(stats) %}
                                                        {% endif %}
                                                    {% endfor %}
                                                    
                                                    {% if visitante_goleadores %}
                                                        <div class="mb-2">
                                                            <p class="mb-1"><strong>âš½ Goleadores:</strong></p>
                                                            <ul class="list-unstyled ml-3">
                                                                {% for jugador in visitante_goleadores %}
                                                                    <li>
                                                                        <span class="text-success"><i class="fas fa-futbol"></i></span> 
                                                                        <strong>{{ jugador.nombre }}</strong> - <span class="badge badge-success">{{ jugador.goles }}</span>
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                        </div>
                                                    {% else %}
                                                        <p class="text-muted mb-2"><em>Sin goles registrados</em></p>
                                                    {% endif %}
                                                    
                                                    {% if visitante_tarjetas %}
                                                        <div class="mb-2">
                                                            <p class="mb-1"><strong>ðŸŸ¨ Tarjetas:</strong></p>
                                                            <ul class="list-unstyled ml-3">
                                                                {% for jugador in visitante_tarjetas %}
                                                                    <li>
                                                                        {{ jugador.nombre }}
                                                                        {% if jugador.amarillas > 0 %}
                                                                            <span class="badge badge-warning">{{ jugador.amarillas }} ðŸŸ¨</span>
                                                                        {% endif %}
                                                                        {% if jugador.rojas > 0 %}
                                                                            <span class="badge badge-danger">{{ jugador.rojas }} ðŸŸ¥</span>
                                                                        {% endif %}
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                        </div>
                                                    {% else %}
                                                        <p class="text-muted"><em>Sin tarjetas registradas</em></p>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="card-footer text-muted">
                    <small>Total de partidos: <strong>{{ datos_fase.partidos|length }}</strong></small>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            <i class="fas fa-info-circle"></i>
            <strong>Sin resultados cargados</strong>
            <p>No hay partidos de playoff con resultados cargados en el sistema.</p>
        </div>
    {% endif %}

    <!-- BotÃ³n para volver -->
    <div class="mt-4">
        <a href="{{ url_for('views.index') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Volver
        </a>
    </div>
</div>

<style>
    .table-hover tbody tr:hover {
        background-color: #f8f9fa !important;
    }
    
    .collapse.show {
        animation: slideDown 0.3s ease-out;
    }
    
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .badge {
        font-size: 0.85rem;
        padding: 0.4rem 0.6rem;
    }
    
    .card-header h4 {
        font-size: 1.3rem;
        margin-bottom: 0;
    }
</style>
{% endblock %}
